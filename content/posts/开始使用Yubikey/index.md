---
title: "å¼€å§‹ä½¿ç”¨ Yubikey"
date: 2022-10-15T19:55:17+09:00
draft: false
tags: ["Yubikey"]
keywords:
  - Yubikey
  - Yubikey 5C NFC
  - Yubikey 5 NFC
  - U2F
  - FIDO2
  - OpenPGP
slug: "getting-started-with-yubikey"
icon: ğŸ”’
---

æ‰˜ Cloudflare çš„ç¦ï¼Œè¿™å‘¨ä¸€çš„æ—¶å€™æ”¶åˆ°äº† Yubico ä»ç‘å…¸å‘æ¥çš„ Yubikeyï¼Œäºæ˜¯è¿™ä¸€å‘¨çš„å¤§éƒ¨åˆ†ä¸šä½™æ—¶é—´éƒ½æ”¾åœ¨äº†æŠ˜è…¾è¿™äº› Key ä¸Šäº†ã€‚

<!--more-->

## è´­ä¹°

è´­ä¹°çš„å¥‘æœºæ˜¯å› ä¸º Cloudflare æœ€è¿‘å’Œ Yubico åˆä½œæ¨å‡ºäº†å¯ä»¥ä»¥éå¸¸ä¾¿å®œçš„ä»·æ ¼ä¹°åˆ° Yubikey 5C NFC å’Œ Yubikey 5 NFC çš„æ´»åŠ¨ï¼ˆæ¯ä¸ª $10ï¼‰ï¼Œä¹‹å‰ä¹Ÿä¸€ç›´æƒ³è´­ä¹°ï¼Œä½†å› ä¸ºä»·æ ¼ã€è½¬è¿ç­‰åŸå› ä¸€ç›´è¿Ÿè¿Ÿæ²¡æœ‰å°è¯•ï¼Œè¿™æ¬¡è¶ç€äººåœ¨å›½å¤–åˆ©ç”¨è¿™ä¸ªæœºä¼šä¸€ä¸‹å­ä¹°äº† 10 ä¸ªã€‚

![4 * Yubikey 5 NFC + 6 * Yubikey 5C NFC è´­ä¹°è®¢å•](yubikey_order.png)

ä¸ºäº†å°½å¿«æ‹¿åˆ°é€‰äº† UPS çš„å¿«é€’ï¼Œæœç„¶éå¸¸å¿«ï¼Œæˆ‘åœ¨ 10/05 ä¸‹å•ï¼Œæ˜¾ç¤º 10/06 ä»ç‘å…¸å‘è´§ï¼Œæˆ‘åœ¨ 10/09 ä¸€æ—©å°±æ”¶åˆ°äº†ï¼ˆåæ ‡ä¸œäº¬ï¼‰ã€‚

## åˆä½“éªŒ

æ‰“å¼€å¿«é€’åŒ…è£…ï¼Œé‡Œé¢æ„å¤–åœ°ç®€æ´ï¼Œå°±æ˜¯ 10 ä¸ª Key åŠ ä¸Šä¸€å¼ å¡ç‰‡ï¼Œä¸Šé¢å‘Šè¯‰æˆ‘å» http://yubico.com/start äº†è§£å¦‚ä½•å¼€å§‹ä½¿ç”¨ã€‚å› ä¸ºè¿™ä¸ª Key å…¶å®åƒæ˜¯ä¸€ä¸ªç¼åˆæ€ªï¼Œæ•´åˆäº†å¥½å‡ ç§éå¸¸ä¸åŒä½†åˆæœ‰æ‰€è”ç³»çš„åŠŸèƒ½ï¼Œå†åŠ ä¸Šè®¸å¤šé™Œç”Ÿè€Œåˆç†Ÿæ‚‰çš„è‹±æ–‡ç®€ç§°ï¼Œæå¾—äº‘é‡Œé›¾é‡Œï¼Œæ¯”å¦‚æ‰“å¼€ Yubikey Manager å°±å¯ä»¥çœ‹åˆ°è¯¸å¦‚ OTP, FIDO U2F, FIDO2, OATH, OpenPGP, PIV...

![Yubikey Manager](yubikey_manager.png)

æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥é€ä¸ªå»äº†è§£ï¼Œæˆ‘å°±ä¸é€ä¸ªå±•å¼€äº†ï¼Œæœ¬æ–‡æƒ³ä»ç”¨é€”ç€æ‰‹ä»‹ç»ä¸€ä¸‹æˆ‘ç›®å‰äº†è§£åˆ°çš„å’Œæ—¥å¸¸ä¼šä½¿ç”¨çš„åŠŸèƒ½ï¼Œè¿™æ ·å¤šå°‘ä¼šç®€å•äº›ã€‚

## ä»£æ›¿é”®ç›˜

ä¸€ä¸ªéå¸¸ä»¤äººè¿·æƒ‘çš„è®¾è®¡å°±æ˜¯è¿™ä¸ª OTPï¼ˆone-time passwordï¼‰åŠŸèƒ½ï¼Œé»˜è®¤æƒ…å†µä¸‹å¦‚æœä½ è§¦æ‘¸ Yubikey ä¸Šçš„é‡‘å±ç‰‡ï¼ˆå¯¹äº†æˆ‘çš„è¿™ä¸ª Yubikey é•¿ä¸‹é¢é‚£æ ·ï¼‰ï¼Œå¾ˆå¯èƒ½ä½ ä¼šæ³¨æ„åˆ°åœ¨ä½ çš„è¾“å…¥æ¡†ä¼šè¾“å‡ºä¸€æ®µå¥‡æ€ªçš„ä¹±ç ï¼Œè¿™å…¶å®æ˜¯ Yubikey çš„ä¸€ä¸ªéå¸¸åŸºç¡€çš„åŠŸèƒ½ï¼Œå°±æ˜¯æ‰®æ¼”ä¸€ä¸ªé”®ç›˜çš„è§’è‰²ï¼Œä¸€ä¸‹å­è¾“å…¥ä¸€ä¸²å­—ç¬¦ï¼Œè¿·æƒ‘çš„ç‚¹åœ¨äºé»˜è®¤æ˜¯è¾“å‡º Yubico è‡ªå®¶çš„ OTPï¼Œç„¶è€Œæˆ‘æ„Ÿè§‰å®ƒä»¬è‡ªå®¶çš„è¿™ä¸ªåè®®å¹¶æ²¡æœ‰å•¥å¤ªå¤§çš„å®é™…ç”¨é€”ï¼Œè€Œå¦‚æœè¿›å…¥è®¾ç½®ç•Œé¢å®Œå…¨å¯ä»¥æŠŠè¿™ä¸ªé»˜è®¤åŠŸèƒ½è®¾ç½®æˆè¾“å‡ºä¸€æ®µå›ºå®šçš„å¯†ç ï¼ˆæ¯”å¦‚æ‰‹åŠ¨è¾“å…¥éå¸¸éº»çƒ¦çš„å¤æ‚å¯†ç ç”¨äºå¼€æœºæˆ–è€…ç¡¬ç›˜å…¨ç›˜åŠ å¯†ç­‰ï¼‰ï¼Œæˆ–æ˜¯è¾“å‡ºç»å¸¸ç”¨äºäºŒæ­¥éªŒè¯çš„ TOTPï¼ˆå°±æ˜¯å¸¸è§çš„å…­ä½æ•°å­—éªŒè¯ç ï¼‰ã€‚å½“ç„¶æˆ‘å…¶å®å¹¶ä¸éœ€è¦è¿™ä¸ªåŠŸèƒ½ï¼Œç›´æ¥ç¦ç”¨äº†ã€‚

![Yubikey 5C NFC](yubkiey_5c_nfc.png)

## 2FAï¼ˆåŒé‡è®¤è¯ï¼‰

å¦å¤–ä¸€ä¸ªæˆ‘ç›®å‰ç”¨å¾—æ¯”è¾ƒå¤šçš„å°±æ˜¯åŒé‡éªŒè¯ï¼ˆä¹Ÿå«åŒå› å­éªŒè¯ç­‰ï¼‰ï¼Œåœ¨æ²¡æœ‰ Yubikey ä¹‹å‰æœ€å¤šç”¨çš„æ˜¯åŸºäºæ—¶é—´çš„ TOTPï¼Œå°±æ˜¯ç™»å½•ç½‘ç«™æ—¶é™¤äº†è¦è´¦å·å¯†ç å¤–ï¼Œè¿½åŠ ä¸€æ­¥éœ€è¦è¾“å…¥ 6 ä½æ•°å­—ï¼Œç°åœ¨å¯ä»¥ç”¨ Yubikey ä½œä¸ºéªŒè¯äº†ï¼Œç®€å•æ¥è¯´ä¹‹å‰éœ€è¦è¾“å…¥ 6 ä½æ•°å­—å¤šå°‘æœ‰ç‚¹å„¿éº»çƒ¦ï¼Œç°åœ¨ç›´æ¥æ‘¸ä¸€ä¸‹ Yubikey çš„é‡‘å±ç‰‡å°±å¯ä»¥å®Œæˆè®¤è¯äº†ï¼Œå…¶ä½¿ç”¨çš„æŠ€æœ¯å«ä½œ FIDO U2Fã€‚è¿™é‡Œè¯´æ˜ä¸€ä¸‹ä½¿ç”¨ Yubikey ä½ å¯ä»¥åœ¨ä»»æ„æ”¯æŒçš„ç½‘ç«™ä¸Šç»‘å®šä½ çš„ Yubikey ä¸ä¼šå ç”¨ä»»ä½• Key ä¸Šçš„å­˜å‚¨ç©ºé—´ï¼Œç»†èŠ‚å¯ä»¥çœ‹ï¼š[Yubicoâ€™s Take on U2F Key Wrapping - Yubico](https://www.yubico.com/blog/yubicos-u2f-key-wrapping/)

æ€»ä¹‹æˆ‘å…ˆååœ¨ä¸‹é¢è¿™äº›ç½‘ç«™å¯ç”¨äº† Yubikey ä½œä¸º 2FAã€‚

- Bitwarden
- Cloudflare
- Google
- GitLab
- GitHub

## OpenPGP

è¿™ä¸ªåŠŸèƒ½ä¹Ÿéå¸¸å®ç”¨è€Œä¸”ç›¸å¯¹ç®€å•ï¼Œåœ¨æ²¡æœ‰ Yubikey ä¹‹å‰ï¼Œæˆ‘ä½¿ç”¨ gpg çš„æ–¹å¼åŸºæœ¬ä¸Šæ˜¯æŠŠä¸“é—¨ç”¨äºç­¾åçš„ subkey ç§é’¥å¯¼å…¥åˆ°ç”µè„‘ï¼Œç„¶åæ¯æ¬¡å¼€æœºçš„æ—¶å€™è¾“å…¥å¯†ç ä¹‹åå°±ä¸ç®¡äº†ï¼Œä½†æ˜¯ä¸ç®¡æ€ä¹ˆè¯´ç§é’¥æœ¬èº«æ˜¯ä¸€ç›´åœ¨ç”µè„‘é‡Œèººç€çš„ï¼Œæœ‰äº† Yubikey ä¹‹åå‘¢ï¼Œå¯ä»¥æŠŠåŸæœ‰çš„ç§é’¥å­˜åˆ° Yubikey é‡Œï¼ŒåŒæ ·ä¹Ÿæ˜¯éœ€è¦ç”¨åˆ°çš„æ—¶å€™æ‘¸ä¸€ä¸‹é‡‘å±ç‰‡å°±è¡Œã€‚æŠŠç§é’¥å­˜åˆ° Yubikey é‡Œä¹Ÿéå¸¸ç®€å•ï¼š

1. ` gpg --edit-key 1234ABC`
2. é€‰æ‹©æƒ³è¦å¯¼å‡ºåˆ° Yubikey çš„ Keyï¼Œäº¤äº’å‘½ä»¤è¡Œä¸­è¾“å…¥ç±»ä¼¼ `key 1`
3. ç„¶åè¾“å…¥ `keytocard`
4. æœ€å `quit` å³å¯

æç¤ºè¦ä¿å­˜çš„åœ°æ–¹é€‰æ‹©ä¿å­˜å°±å¤§åŠŸå‘Šæˆäº†ï¼Œæœ‰ä¸€ç‚¹å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä¹‹åæœ¬æœºçš„ç§é’¥å°±ä¼šæ²¡æœ‰äº†ï¼Œéœ€è¦è‡ªå·±æ³¨æ„å¤‡ä»½ã€‚è¯¦ç»†çš„æ­¥éª¤å¯ä»¥å‚è€ƒå®˜æ–¹æ•™ç¨‹ï¼š[Using Your YubiKey with OpenPGP â€“ Yubico](https://support.yubico.com/hc/en-us/articles/360013790259-Using-Your-YubiKey-with-OpenPGP)

è½¬ç§»åˆ° Yubikey ä¹‹åï¼Œå†åœ¨æœ¬æœºè¿è¡Œ `gpg --list-secret-keys` ä¼šæ˜¾ç¤ºç±»ä¼¼ä¸‹é¢è¿™æ ·ï¼Œæ³¨æ„ `ssb>` å°±æ„å‘³ç€ç§é’¥åœ¨å®ä½“çš„ Yubikey ä¸Šäº†ã€‚

```
/home/yuanji/.gnupg/pubring.kbx
-------------------------------
sec#  rsa4096 2018-06-20 [SC]
      1D5AB52A241CC492A724FE14E8D79E63E3D142F3
uid           [ultimate] Yuanji <self@gimo.me>
uid           [ultimate] Yuanji (Douban Inc.) <yuanji@douban.com>
ssb>  rsa4096 2018-06-20 [E]
ssb>  rsa4096 2018-12-04 [S]
```

## SSH

æœ€åä¸€ä¸ªä¹Ÿæ˜¯æ—¥å¸¸ä½¿ç”¨æœ€å¤šçš„åŠŸèƒ½ï¼Œé SSH è«å±ï¼Œä¸ä»…ç™»å½•æœåŠ¡å™¨éœ€è¦å®ƒï¼ŒPush ä»£ç ä¹Ÿç”¨å®ƒï¼Œæˆ‘è¿˜æœ‰ä¸€ä¸ªç‰¹åˆ«çš„éœ€æ±‚ï¼Œå°±æ˜¯æˆ‘åŠ å¯†äº† VPS çš„ root åˆ†åŒºï¼Œæ¯æ¬¡å¯åŠ¨æˆ‘éœ€è¦[é€è¿‡ SSH æ¥è¾“å…¥ LUKS çš„å¯†ç ](<https://wiki.archlinux.org/title/Dm-crypt/Specialties#Remote_unlocking_of_the_root_(or_other)_partition>)ï¼Œä¸è¿‡ç½‘ä¸Šæœ‰å…³å¦‚ä½•ä½¿ç”¨ Yubikey æ¥è¿æ¥ SSH çš„æ•™ç¨‹å¾ˆå¤šéƒ½å·²ç»è¿‡æ—¶ï¼Œåˆå› ä¸º Yubikey æä¾›äº†å¥½å‡ ç§ä¸åŒçš„æ–¹å¼æ¥å®ç°æ›´å®‰å…¨çš„ SSH ä½¿ç”¨ï¼Œæ¯”å¦‚ä½¿ç”¨ä¸Šæ–‡æåˆ°çš„ OpenPGPï¼Œä»¥åŠ PIV éƒ½èƒ½ç”¨äº SSHï¼Œè€Œ 2022 å¹´ç°åœ¨æˆ‘æ„Ÿè§‰åªè¦ä¸æ˜¯å¯¹åº”çš„æœåŠ¡å™¨å¤ªè€ï¼ŒSSH æœåŠ¡ç«¯ä»¥åŠå®¢æˆ·ç«¯çš„è½¯ä»¶å¤ªæ—§ï¼ŒFIDO U2F æˆ–æ˜¯ FIDO2 åº”è¯¥æ˜¯æœ€ä¸ºç®€å•çš„äº†ï¼Œæˆ‘é€‰æ‹©çš„æ­£æ˜¯è¿™ç§æ–¹å¼ï¼Œ[å®˜æ–¹çš„æ–‡æ¡£](https://developers.yubico.com/SSH/Securing_SSH_with_FIDO2.html)éå¸¸è¯¦ç»†ï¼Œä¸‹é¢æ‘˜è¦äº†ä¸€äº›é‡è¦çš„éƒ¨åˆ†ã€‚

### FIDO U2F

é¦–å…ˆè¯´è¿™ä¸ª **U2F** å®é™…ä¸Šå’Œä¸Šæ–‡è¯´çš„ç½‘ç«™çš„å¤šé‡è®¤è¯ç”¨çš„æ˜¯ä¸€ä¸ªåŸç†ï¼Œæ ¹æ® Yubikey çš„å®ç°ä½ å¯ä»¥ç”Ÿæˆä»»æ„å¤šçš„ SSH keypairã€‚ç”Ÿæˆçš„è¿‡ç¨‹å’Œæ™®é€šç”¨ `ssh-keygen` æ²¡å•¥ä¸¤æ ·ï¼Œä¸è¿‡ Key çš„ç±»å‹å¯ä»¥é€‰æ‹© `ed25519-sk` æˆ–æ˜¯ `ecdsa-sk` å–å†³ä¸ä½  Yubikey çš„æ”¯æŒæƒ…å†µï¼Œæˆ‘çš„è¯é€‰æ‹©äº† `ed25519-sk`ï¼Œé¡ºä¾¿ä¸€æè¿™ä¸ª `sk` å³ security key çš„æ„æ€ã€‚å®Œæ•´çš„å‘½ä»¤å¤§æ¦‚è¿™æ ·ï¼š

```bash
ssh-keygen -t ed25519-sk -C "Yubikey 5 NFC/xxxxxxxx"
```

å¤‡æ³¨é‡Œå¯ä»¥å†™ä¸Šåºåˆ—å·ä»¥åŒºåˆ«ä¸åŒçš„ Yubikeyï¼Œå°±å’Œæ™®é€šç”Ÿæˆ key pair ä¸€æ ·ï¼Œä¸Šé¢çš„å‘½ä»¤ä¼šç”Ÿæˆä¸€ä¸ª `~/.ssh/id_ed25519_sk.pub`ï¼ˆå…¬é’¥ï¼‰ å’Œä¸€ä¸ª `~/.ssh/id_ed25519_sk`ï¼ˆç§é’¥ï¼‰ï¼Œåªæ˜¯è¿™ä¸ªç§é’¥ä¸æ˜¯çœŸçš„ç§é’¥è€Œæ˜¯ä¸€ä¸ªå« `key handle` çš„ä¸œè¥¿ï¼Œå®ƒåœ¨ç»“åˆæ¯ä¸ª Yubikey å”¯ä¸€çš„â€œç§é’¥â€å°±å¯ä»¥åœ¨è®¤è¯æ—¶å¾—åˆ°çœŸæ­£å¯¹åº”çš„ç§é’¥æ¥å®Œæˆè®¤è¯è¿‡ç¨‹ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘è¯´ä½¿ç”¨ U2F å¯ä»¥ä¸å—é™åˆ¶ç”Ÿæˆä»»æ„å¤šçš„ key pairï¼Œå› ä¸ºè¿™ä¸ª `key handle` å‹æ ¹ä¸å­˜åœ¨ Yubikey é‡Œï¼Œè‡ªç„¶ä¹Ÿå°±ä¸å ç”¨ä»»ä½• Yubikey æœ¬èº«çš„å­˜å‚¨ç©ºé—´äº†ã€‚

### FIDO2

é‚£ä¹ˆå¦‚æœä½ è¦åœ¨ä¸åŒçš„ç”µè„‘ä¸Šä½¿ç”¨ä¸Šé¢ç”Ÿæˆçš„ key pair å‘¢ï¼Ÿä½ éœ€è¦æŠŠåœ¨ä¸€å°ç”µè„‘ä¸Šå­˜çš„ `key handle` è½¬å­˜åˆ°å¦å¤–ä¸€å°ç”µè„‘ä¸Šï¼Œç„¶ååœ¨å¦å¤–é‚£å°ç”µè„‘ä¸Šæ’ä¸Š Yubikey å°±å¯ä»¥ç»§ç»­ä½¿ç”¨äº†ã€‚è¿™æ ·çš„æ–¹å¼å¤šå°‘æœ‰ç‚¹å„¿éº»çƒ¦ï¼Œäºæ˜¯å°±æœ‰äº† **FIDO2** çš„ç™»åœºï¼Œè¿‡äºå…·ä½“çš„ç»†èŠ‚æˆ‘ä¹Ÿä¸å¤ªäº†è§£ï¼Œä½†æ˜¯åˆ°ä½¿ç”¨å’Œç†è§£ä¸Šå¹¶ä¸å¤æ‚ï¼Œè¿˜æ˜¯ä¸€æ ·çš„ç”Ÿæˆ key pair å‘½ä»¤ï¼Œåªæ˜¯åŠ ä¸Šä¸€ä¸ªå« `-O resident` çš„é€‰é¡¹å³å¯ï¼Œè¿™æ ·å°±ä¼šæŠŠä¸Šé¢æ‰€è¯´çš„ `key handle` å­˜åˆ° Yubikey é‡Œï¼Œè¿™æ ·åˆ°æ–°çš„æœºå™¨ä¸Šï¼Œè¿è¡Œ `ssh-keygen -K` å°±å¯ä»¥æŠŠ `key handle` è‡ªåŠ¨å¯¼å…¥ç›®æ ‡æœºå™¨ï¼Œæ˜¯ä¸æ˜¯å¾ˆæ–¹ä¾¿å‘¢ï¼Ÿä¹‹åçš„ä½¿ç”¨è¿‡ç¨‹åº”è¯¥å°±å’Œä¸Šè¿° FIDO U2F æ–¹å¼ä¸€æ ·äº†ï¼Œæ‘¸ä¸€æ‘¸ Yubikey å°±å¯ä»¥å®ŒæˆéªŒè¯äº†ã€‚å½“ç„¶äº†å®ƒçš„åå¤„å°±æ˜¯ä¼šå ç”¨ Yubikey çš„å­˜å‚¨ç©ºé—´ã€‚å…³äº Yubikey å­˜å‚¨ç©ºé—´çš„é™åˆ¶ï¼Œå¯ä»¥å‚è€ƒï¼š[How many accounts can I register my YubiKey with? â€“ Yubico](https://support.yubico.com/hc/en-us/articles/360013790319-How-many-accounts-can-I-register-my-YubiKey-with-)

å¦å¤–ï¼Œå¦‚æœä½ éœ€è¦å…¶ä»–æ–¹å¼æ¥ä¿æŠ¤ SSH çš„è®¤è¯ï¼Œå¯ä»¥æŸ¥çœ‹ [Securing SSH with OpenPGP or PIV](https://developers.yubico.com/PIV/Guides/Securing_SSH_with_OpenPGP_or_PIV.html)

## æœ€å

ä¸Šé¢å‡ ç§å°±æ˜¯æˆ‘ä¸€å‘¨ä»¥æ¥ç›®å‰å¸¸ç”¨åˆ°çš„ Yubikey çš„åŠŸèƒ½äº†ï¼Œå…¶ä»–çš„ä¸€äº›è¯¸å¦‚æŠŠ TOTP ä¿¡æ¯ä¿å­˜åˆ° Yubikey é‡ŒåŠŸèƒ½æˆ‘æ„Ÿè§‰ä¸å¤ªç”¨çš„åˆ°è€Œä¸” Yubikey çš„ç©ºé—´æœ‰é™ï¼Œå°±ä¸ä¸€ä¸€ä»‹ç»äº†ã€‚å¯¹äº†ï¼Œé¡ºä¾¿ä¸€ææ—¢ç„¶ç”¨äº† Yubikey çš„è¯æœ€å¥½æœ‰ä¸ªå¤‡ä»½é”®ï¼Œå…³é”®çš„æ—¶å€™ä¹Ÿè®¸ä¼šç”¨ä¸Šã€‚æ‰€ä»¥ä¸Šé¢ä»‹ç»çš„ç”¨é€”æˆ‘éƒ½æœ‰è®¾ç½®åˆ°ä¸€ä¸»ä¸€å¤‡ä¸¤ä¸ª Yubikey ä¸Šã€‚

æœ€åï¼Œå¦‚æœä¹Ÿæœ‰å¯¹ Yubikey è·ƒè·ƒæ¬²è¯•çš„è¯»è€…ä¸å¦¨å…ˆçœ‹çœ‹ [Works with YubiKey catalog | Yubico](https://www.yubico.com/jp/works-with-yubikey/catalog/?sort=popular) æ˜¯ä¸æ˜¯éƒ½æœ‰ä½ å¸¸ç”¨çš„è½¯ä»¶ã€ç½‘ç«™æˆ–å¹³å°ã€‚
